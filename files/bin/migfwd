#!/bin/bash

readonly DATE_FORMAT="%Y%m%d%H%M%S"
readonly DATE_PATTERN='[0-9]\{14\}' # Match a date given in DATE_FORMAT

function _print_usage() {
  echo "Usage: $0 PATH_TO_MIGRATION_FILE"
}

function _new_date() {
  date +"$DATE_FORMAT"
}

function _new_path() {
  local old_path date
  old_path="$1"
  date="$(_new_date)"

  # shellcheck disable=SC2001
  echo "$old_path" | sed "s/$DATE_PATTERN/$date/"
}

function _rename_migration_to_current_timestamp() {
  local migration_file_path new_path
  migration_file_path="$1"
  new_path="$(_new_path "$migration_file_path")"

  (set -x; mv "$migration_file_path" "$new_path")
}

if [ $# != 1 ]; then
  _print_usage
  exit 1
fi

_rename_migration_to_current_timestamp "$1"
exit 0
