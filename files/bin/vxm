#!/bin/bash

OK=0
USAGE=1
SCRIPT_NAME="$(basename $0)"
DEFAULT_LIST="$HOME/src/dotfiles/files/$SCRIPT_NAME.list"

LIST=${LIST:-$DEFAULT_LIST}

USAGE_TEXT="Usage: $SCRIPT_NAME [ACTION]

ACTIONS
  merge  - [default] import then export
  import - install extensions listed in LIST
  export - write list of installed extensions to LIST

LIST
  The path to the list.
  Default LIST: $DEFAULT_LIST
  Current LIST: $LIST
  Override by setting LIST environment variable, e.g.

    LIST=my/list.txt $SCRIPT_NAME import
"

_import() {
  set -x
  cat "$LIST" | while read extension; do
    yes 0 | code --install-extension $extension
  done
  set +x
}

_export() {
  set -x
  code --list-extensions | tee "$LIST"
  set +x
}

_print_usage_and_exit() {
  echo "$USAGE_TEXT"
  exit $1
}

case "$1" in
merge | '')
  _import && _export
  ;;
import)
  _import
  ;;
export)
  _export
  ;;
-h | --help | help)
  _print_usage_and_exit $OK
  ;;
*)
  _print_usage_and_exit $USAGE
  ;;
esac

:
