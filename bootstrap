#!/bin/bash

set -e

readonly dotfiles="$HOME/.dotfiles"
readonly repo='https://github.com/justinforce/dotfiles'

echo -e "\e[1;32mReticulating splines...\e[m"

##############
# Update APT #
##############

sudo apt-get update

###################
# Install prereqs #
###################

sudo apt-get install --yes git

###########################
# Set up Ruby environment #
###########################

gpg --keyserver hkp://keys.gnupg.net --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3
curl -L https://get.rvm.io | bash -s stable

source ~/.rvm/scripts/rvm
rvm use ruby --install --default

gem install bundler

########################
# Clone or update repo #
########################

if [ -e "$dotfiles" ]; then
  cd "$dotfiles"
  git pull origin master
  git submodule sync
  git submodule update --init
else
  git clone --recursive "$repo" "$dotfiles"
fi

######################################
# Bundle and run preferred rake task #
######################################

cd "$dotfiles"
bundle install
rake force
