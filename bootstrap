#!/bin/bash

dotfiles="$HOME/.dotfiles"
repo='https://github.com/justinforce/dotfiles'

clone_or_update_repo() {
  if [ -e "$dotfiles" ]; then
    cd "$dotfiles"
    git pull origin master
    git submodule sync
    git submodule update --init
  else
    git clone --recursive "$repo" "$dotfiles"
  fi
}

set_up_ruby_environment() {
  ( which rbenv && rbenv install -h ) &>/dev/null && return
  git clone https://github.com/sstephenson/rbenv.git ~/.rbenv
  git clone https://github.com/sstephenson/ruby-build.git ~/.rbenv/plugins/ruby-build
  export PATH="$HOME/.rbenv/bin:$PATH"
  eval "$(rbenv init -)"
  which bundle || gem install bundler
}

run_rake_task() {
  cd "$dotfiles"
  rake force
}

main() {
  echo -e "\e[1;32mReticulating splines...\e[m"
  set_up_ruby_environment
  clone_or_update_repo
  run_rake_task
}

main

:
